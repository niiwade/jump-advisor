"use strict";(()=>{var e={};e.id=717,e.ids=[717],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},16141:e=>{e.exports=require("node:zlib")},19771:e=>{e.exports=require("process")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},35544:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>b,routeModule:()=>q,serverHooks:()=>y,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>x});var o=t(96559),a=t(48088),n=t(37719),i=t(32190),u=t(70132),p=t(61690),d=t(11572),c=t(6075),l=t(94112);async function x(e){try{let r,{source:t,userId:s,data:o}=await e.json();if(!t||!s||!o)return i.NextResponse.json({error:"Invalid webhook payload"},{status:400});if(!await u.z.user.findUnique({where:{id:s}}))return i.NextResponse.json({error:"User not found"},{status:404});switch(t){case"gmail":r=await h(s,o);break;case"calendar":r=await m(s,o);break;case"hubspot":r=await w(s,o);break;default:return i.NextResponse.json({error:"Unknown webhook source"},{status:400})}return i.NextResponse.json({success:!0,result:r})}catch(e){return console.error("Webhook error:",e),i.NextResponse.json({error:"Failed to process webhook"},{status:500})}}async function h(e,r){if(!r.emailId)throw Error("emailId is required");let t=await (0,p.tO)(e,r);if((await u.z.instruction.findMany({where:{userId:e,active:!0}})).length>0){let t=`New email received:
    From: ${r.from}
    Subject: ${r.subject}
    
    Based on the user's instructions, determine if any action is needed.`,s=(await u.z.chatMessage.findMany({where:{userId:e},orderBy:{createdAt:"desc"},take:10})).map(e=>({role:e.role,content:e.content,id:e.id||`msg-${Math.random().toString(36).substring(2,11)}`})),o=await (0,l.E)(e,t,s.map(e=>({...e,id:`msg-${Math.random().toString(36).substring(2,11)}`})));await u.z.chatMessage.create({data:{userId:e,role:"system",content:`[Automated] ${o}`}})}return t}async function m(e,r){let t=await (0,d.xN)(e,r);if((await u.z.instruction.findMany({where:{userId:e,active:!0}})).length>0){let t=`New calendar event: 
    Title: ${r.title}
    Start: ${r.startTime}
    End: ${r.endTime}
    Attendees: ${r.attendees?.join(", ")||"None"}
    
    Based on the user's instructions, determine if any action is needed.`,s=(await u.z.chatMessage.findMany({where:{userId:e},orderBy:{createdAt:"desc"},take:10})).map(e=>({role:e.role,content:e.content,id:e.id||`msg-${Math.random().toString(36).substring(2,11)}`})),o=await (0,l.E)(e,t,s.map(e=>({...e,id:`msg-${Math.random().toString(36).substring(2,11)}`})));await u.z.chatMessage.create({data:{userId:e,role:"system",content:`[Automated] ${o}`}})}return t}async function w(e,r){let t=await (0,c.qj)(e,r);if((await u.z.instruction.findMany({where:{userId:e,active:!0}})).length>0){let t=`New HubSpot contact: 
    Email: ${r.properties?.email||"Unknown"}
    Name: ${r.properties?.firstname||""} ${r.properties?.lastname||""}
    
    Based on the user's instructions, determine if any action is needed.`,s=(await u.z.chatMessage.findMany({where:{userId:e},orderBy:{createdAt:"desc"},take:10})).map(e=>({role:e.role,content:e.content,id:e.id||`msg-${Math.random().toString(36).substring(2,11)}`})),o=await (0,l.E)(e,t,s);await u.z.chatMessage.create({data:{userId:e,role:"system",content:`[Automated] ${o}`}})}return t}let q=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/webhook/route",pathname:"/api/webhook",filename:"route",bundlePath:"app/api/webhook/route"},resolvedPagePath:"C:\\Users\\Joseph\\Documents\\Jump\\jump-advisor\\src\\app\\api\\webhook\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:y}=q;function b(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},37067:e=>{e.exports=require("node:http")},37830:e=>{e.exports=require("node:stream/web")},44708:e=>{e.exports=require("node:https")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57075:e=>{e.exports=require("node:stream")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},73136:e=>{e.exports=require("node:url")},73496:e=>{e.exports=require("http2")},73566:e=>{e.exports=require("worker_threads")},74075:e=>{e.exports=require("zlib")},76760:e=>{e.exports=require("node:path")},77030:e=>{e.exports=require("node:net")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},83997:e=>{e.exports=require("tty")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[243,580,582,957,112],()=>t(35544));module.exports=s})();